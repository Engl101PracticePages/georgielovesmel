<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Georgie Loves Mel</title>

<style>
:root{
color-scheme:dark;
--bg:#0b1020;
--card:#101a33;
--ink:#eef2ff;
--muted:#aab4ff;
--accent:#8aa4ff;
--border:#243055;
--radius:18px;
}

body{
margin:0;
background:var(--bg);
color:var(--ink);
font-family:system-ui;
}

.wrap{
max-width:900px;
margin:auto;
padding:30px;
}

.card{
background:var(--card);
padding:20px;
border-radius:var(--radius);
border:1px solid var(--border);
margin-bottom:16px;
}

button{
background:none;
border:1px solid var(--border);
color:var(--ink);
padding:12px;
border-radius:12px;
cursor:pointer;
margin:4px;
}

button.active{
border-color:var(--accent);
color:var(--accent);
}

.result{
font-size:1.4rem;
margin-top:12px;
}

.badge{
margin-right:8px;
color:var(--muted);
}

</style>
</head>
<body>

<div class="wrap">

<div class="card">

<h2>Dinner Oracle</h2>

<div>
Category:
<button onclick="setCategory('food')" id="cat-food">Food</button>
<button onclick="setCategory('dessert')" id="cat-dessert">Dessert</button>
<button onclick="setCategory('either')" id="cat-either" class="active">Either</button>
</div>

<div>
Price:
<button onclick="setPrice('$')" id="price-$">$</button>
<button onclick="setPrice('$$')" id="price-$$">$$</button>
<button onclick="setPrice('$$$')" id="price-$$$">$$$</button>
<button onclick="setPrice('any')" id="price-any" class="active">Any</button>
</div>

<div>
Speed:
<button onclick="setSpeed('quick')" id="speed-quick">Quick</button>
<button onclick="setSpeed('normal')" id="speed-normal">Normal</button>
<button onclick="setSpeed('slow')" id="speed-slow">Slow</button>
<button onclick="setSpeed('any')" id="speed-any" class="active">Any</button>
</div>

<div>
Distance:
<button onclick="setDistance('near')" id="dist-near">Near</button>
<button onclick="setDistance('any')" id="dist-any" class="active">Anywhere</button>
</div>

<div style="margin-top:12px;">
<button onclick="pick()">Pick</button>
<button onclick="pick()">Reroll</button>
</div>

<div class="result" id="result"></div>
<div id="badges"></div>

</div>
</div>

<script>

let restaurants=[]

let filters={
category:"either",
price:"any",
speed:"any",
distance:"any"
}

let userLocation=null

navigator.geolocation.getCurrentPosition(
pos=>{
userLocation={
lat:pos.coords.latitude,
lng:pos.coords.longitude
}
},
()=>{}
)

function setCategory(v){
filters.category=v
highlight("cat",v)
}

function setPrice(v){
filters.price=v
highlight("price",v)
}

function setSpeed(v){
filters.speed=v
highlight("speed",v)
}

function setDistance(v){
filters.distance=v
highlight("dist",v)
}

function highlight(prefix,value){
document.querySelectorAll(`[id^=${prefix}-]`).forEach(b=>b.classList.remove("active"))
document.getElementById(`${prefix}-${value}`).classList.add("active")
}

function distance(a,b){

if(!userLocation||!a.lat)return 9999

let dx=userLocation.lat-a.lat
let dy=userLocation.lng-a.lng

return Math.sqrt(dx*dx+dy*dy)

}

function minutesUntil(closeISO){

if(!closeISO)return null

return Math.round((new Date(closeISO)-Date.now())/60000)

}

function pick(){

let pool=restaurants.filter(r=>{

if(!r.open_now)return false

if(filters.category!="either"&&r.category!=filters.category)return false

if(filters.price!="any"&&r.price!=filters.price)return false

if(filters.speed!="any"&&r.speed!=filters.speed)return false

if(filters.distance=="near"&&distance(r)>0.05)return false

return true

})

if(pool.length==0){

document.getElementById("result").innerText="No open matches"

return
}

let r=pool[Math.floor(Math.random()*pool.length)]

document.getElementById("result").innerHTML=
`<a href="${r.google_maps_url}" target="_blank">${r.name}</a>`

let badges=[]

let mins=minutesUntil(r.next_close_iso)

if(mins!==null){

if(mins<=45)badges.push(`Closing in ${mins} min`)
else badges.push("Open")

}

document.getElementById("badges").innerHTML=
badges.map(b=>`<span class="badge">${b}</span>`).join("")

}

fetch("restaurants.json")
.then(r=>r.json())
.then(data=>{

restaurants=data.restaurants||[]

})

</script>

</body>
</html>
